use Algorithm::Combinatorics qw(variations_with_repetition);

sub f {
    my %seen;
    grep !$seen{ eval $_ }++,
    map $$_[0],
    sort { $$a[1] <=> $$b[1] }
    map [ $_, eval $_ ],
    map join( '/', @$_ ),
    variations_with_repetition [ 1 .. shift ], 2
}

print join(',',f(shift@$_)) eq join(',',@$_) ? "ok\n" : "ERROR\n" for
[ 3 => '1/3', '1/2', '2/3', '1/1', '3/2', '2/1', '3/1' ],
[ 4 => '1/4', '1/3', '1/2', '2/3', '3/4', '1/1', '4/3', '3/2', '2/1', '3/1', '4/1' ],
[ 1 => '1/1' ],
[ 6 => '1/6', '1/5', '1/4', '1/3', '2/5', '1/2', '3/5', '2/3', '3/4', '4/5', '5/6', '1/1', '6/5', '5/4', '4/3', '3/2', '5/3', '2/1', '5/2', '3/1', '4/1', '5/1', '6/1' ],
[ 5 => '1/5', '1/4', '1/3', '2/5', '1/2', '3/5', '2/3', '3/4', '4/5', '1/1', '5/4', '4/3', '3/2', '5/3', '2/1', '5/2', '3/1', '4/1', '5/1' ],
